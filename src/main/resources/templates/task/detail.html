<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('タスク詳細 - Task Manager')}"></head>
<body class="bg-light">
<header th:replace="~{fragments/layout :: header}"></header>

<main class="container py-4">
    <!-- パンくずリスト -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/tasks}">タスク一覧</a></li>
            <li class="breadcrumb-item active" aria-current="page">詳細</li>
        </ol>
    </nav>

    <!-- 成功メッセージ -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i><span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h1 class="h5 mb-0">
                        <i class="bi bi-file-text me-2"></i>タスク詳細
                    </h1>
                    <div class="btn-group">
                        <a th:href="@{/tasks/{id}/edit(id=${task.id})}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-pencil me-1"></i>編集
                        </a>
                        <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            <i class="bi bi-trash me-1"></i>削除
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-3 text-muted">タイトル</dt>
                        <dd class="col-sm-9 fw-medium" th:text="${task.title}"></dd>

                        <dt class="col-sm-3 text-muted">説明</dt>
                        <dd class="col-sm-9">
                            <p th:if="${task.description}" th:text="${task.description}" class="mb-0" style="white-space: pre-wrap;"></p>
                            <span th:unless="${task.description}" class="text-muted">-</span>
                        </dd>

                        <dt class="col-sm-3 text-muted">ステータス</dt>
                        <dd class="col-sm-9">
                            <span class="badge"
                                  th:classappend="${task.status.name() == 'TODO'} ? 'bg-secondary' : (${task.status.name() == 'IN_PROGRESS'} ? 'bg-primary' : 'bg-success')"
                                  th:text="${task.statusDisplayName}"></span>
                        </dd>

                        <dt class="col-sm-3 text-muted">優先度</dt>
                        <dd class="col-sm-9">
                            <span class="badge"
                                  th:classappend="${task.priority.name() == 'LOW'} ? 'bg-info' : (${task.priority.name() == 'MEDIUM'} ? 'bg-warning text-dark' : 'bg-danger')"
                                  th:text="${task.priorityDisplayName}"></span>
                        </dd>

                        <dt class="col-sm-3 text-muted">カテゴリー</dt>
                        <dd class="col-sm-9">
                            <span th:if="${task.categoryName != null}" class="badge"
                                  th:style="'background-color: ' + ${task.categoryColor} + ';'"
                                  th:text="${task.categoryName}"></span>
                            <span th:unless="${task.categoryName != null}" class="text-muted">-</span>
                        </dd>

                        <dt class="col-sm-3 text-muted">期限</dt>
                        <dd class="col-sm-9" th:text="${task.dueDate != null} ? ${#temporals.format(task.dueDate, 'yyyy/MM/dd')} : '-'"></dd>

                        <dt class="col-sm-3 text-muted">作成日時</dt>
                        <dd class="col-sm-9" th:text="${#temporals.format(task.createdAt, 'yyyy/MM/dd HH:mm')}"></dd>

                        <dt class="col-sm-3 text-muted">更新日時</dt>
                        <dd class="col-sm-9" th:text="${#temporals.format(task.updatedAt, 'yyyy/MM/dd HH:mm')}"></dd>
                    </dl>
                </div>
            </div>

            <div class="mt-3">
                <a th:href="@{/tasks}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>一覧に戻る
                </a>
            </div>
        </div>
    </div>
</main>

<!-- 削除確認モーダル -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="bi bi-exclamation-triangle text-danger me-2"></i>削除確認
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                このタスクを削除してもよろしいですか？<br>
                <strong th:text="${task.title}"></strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">キャンセル</button>
                <form th:action="@{/tasks/{id}/delete(id=${task.id})}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash me-1"></i>削除
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="~{fragments/layout :: footer}"></th:block>
</body>
</html>

# 画面設計書

> **出力先**: `docs/screen/画面設計書/`
> **ファイル名**: `SCR-CAT-002_カテゴリー新規登録.md`

## 1. 文書情報
| 項目 | 内容 |
| :--- | :--- |
| **画面ID** | SCR-CAT-002 |
| **画面名** | カテゴリー新規登録 |
| **バージョン** | 1.0.0 |
| **作成日** | 2025-12-10 |
| **作成者** | 画面設計エージェント |
| **最終更新日** | 2025-12-10 |
| **最終更新者** | Claude (screen-designer) |

---

## 2. 概要
### 2.1. 画面目的
新規カテゴリーを登録するための画面。カテゴリー名、説明、カラーコード、表示順を入力し、バリデーションを実施した上でデータベースに登録する。

### 2.2. 前提条件
- タスク管理システムにアクセス可能であること

---

## 3. レイアウト
### 3.1. 画面スクリーンショット

> **📌 モックアップファイル**: `docs/mockups/08_category_form.html`

![SCR-CAT-002 カテゴリー新規登録](../images/SCR-CAT-002.png)


### 3.2. レイアウト構成
- **ヘッダー**: 共通ナビゲーションバー（Task Managerロゴとアイコン）
- **メインコンテンツ**:
  - パンくずリスト: カテゴリー一覧 > 新規登録
  - フォームカード:
    - カードヘッダー: 「新規カテゴリー登録」（アイコン `bi-plus-circle` 付き）
    - カードボディ: 入力フォーム
      - カテゴリー名（必須、テキスト入力、maxlength=50）
      - 説明（任意、テキストエリア、maxlength=200）
      - カラー（任意、カラーピッカー、初期値: #6c757d）
      - 表示順（任意、数値入力、初期値: 0）
    - ボタンエリア: キャンセル、登録
  - バリデーションエラー表示サンプルカード（モックアップのみ）
- **フッター**: 共通フッター（© 2025 Task Manager Application - Multi-Agent Demo）

---

## 4. 画面遷移
### 4.1. 遷移元
| 画面ID | 画面名 | 遷移トリガー | 備考 |
| :--- | :--- | :--- | :--- |
| SCR-CAT-001 | カテゴリー一覧 | 「新規カテゴリー」ボタン押下 | - |

### 4.2. 遷移先
| 画面ID | 画面名 | 遷移トリガー | 備考 |
| :--- | :--- | :--- | :--- |
| SCR-CAT-001 | カテゴリー一覧 | 「キャンセル」ボタン押下 | 入力内容は破棄される |
| SCR-CAT-001 | カテゴリー一覧 | 登録成功時 | 成功メッセージ「カテゴリーを登録しました」を表示 |

---

## 5. 画面項目一覧
| No. | 項目ID | 論理名 | ラベル/物理名 | 種別 | 必須 | 初期値/状態 | 備考 |
| :-: | :--- | :--- | :--- | :--- | :-: | :--- | :--- |
| 1 | BC-201 | パンくずリスト | - | ナビゲーション | - | 固定表示 | カテゴリー一覧 > 新規登録 |
| 2 | S-201 | 画面タイトル | 新規カテゴリー登録 | テキスト表示 | - | 固定表示 | アイコン `bi-plus-circle` 付き |
| 3 | I-201 | カテゴリー名入力 | カテゴリー名 | テキスト入力 | ✔ | 空 | maxlength=50、placeholder="カテゴリー名を入力" |
| 4 | H-201 | カテゴリー名ヘルプ | - | ヘルプテキスト | - | 固定表示 | 「50文字以内で入力してください」 |
| 5 | E-201 | カテゴリー名エラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 6 | I-202 | 説明入力 | 説明 | テキストエリア | - | 空 | rows=3、maxlength=200、placeholder="カテゴリーの説明を入力" |
| 7 | H-202 | 説明ヘルプ | - | ヘルプテキスト | - | 固定表示 | 「200文字以内で入力してください」 |
| 8 | E-202 | 説明エラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 9 | I-203 | カラー選択 | カラー | カラーピッカー | - | #6c757d | type="color"、16進数カラーコード（例: #FF5733） |
| 10 | H-203 | カラーヘルプ | - | ヘルプテキスト | - | 固定表示 | 「カテゴリーを識別する色を選択してください」 |
| 11 | I-204 | 表示順入力 | 表示順 | 数値入力 | - | 0 | type="number"、min=0、step=1 |
| 12 | H-204 | 表示順ヘルプ | - | ヘルプテキスト | - | 固定表示 | 「小さい数値ほど上位に表示されます」 |
| 13 | E-204 | 表示順エラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 14 | B-201 | キャンセルボタン | キャンセル | ボタン | - | 活性 | `/categories` へ遷移、アイコン `bi-x-lg` 付き |
| 15 | B-202 | 登録ボタン | 登録 | ボタン | - | 活性 | フォーム送信、アイコン `bi-check-lg` 付き |

---

## 6. イベント仕様
### 6.1. 初期表示処理 (`onLoad`)
1. コントローラー `GET /categories/new` が呼び出される
2. 以下のデータをモデルに設定する:
   - `categoryForm`: 初期値設定済みの CategoryForm (color=#6c757d, display_order=0)
3. ビュー `category/form.html` をレンダリングする

### 6.2. 入力項目変更時 (`onChange`)
- （特別な処理なし）

### 6.3. ボタン押下時 (`onClick`)
#### キャンセルボタン（B-201）
1. `/categories` へ遷移する
2. 入力内容は破棄される

#### 登録ボタン（B-202）
1. フォーム内の入力値を取得する
2. POST メソッドで `/categories` へリクエストを送信する
3. サーバーサイドバリデーションを実行する（詳細は「7. 画面チェック仕様」を参照）
4. バリデーションエラーがある場合:
   - BindingResult にエラー情報が格納される
   - ビュー `category/form.html` を再表示する
   - エラーメッセージが各入力項目の下に表示される（`invalid-feedback`）
   - 入力済みの値は保持される
5. バリデーション成功の場合:
   - CategoryService.create() を呼び出してカテゴリーを登録する
   - フラッシュ属性に成功メッセージ「カテゴリーを登録しました」を設定する
   - カテゴリー一覧画面 `/categories` へリダイレクトする

---

## 7. 画面チェック仕様（バリデーション）
### 7.1. 登録/更新ボタン押下時 (クライアントサイド)
| No. | 対象項目 | チェック内容 | 条件/正規表現 | エラーメッセージ |
| :-: | :--- | :--- | :--- | :--- |
| 1 | I-201 | 必須入力 | `@NotBlank` | 「カテゴリー名を入力してください」 |
| 2 | I-201 | 最大文字数 | `@Size(max=50)` | 「カテゴリー名は50文字以内で入力してください」 |
| 3 | I-202 | 最大文字数 | `@Size(max=200)` | 「説明は200文字以内で入力してください」 |
| 4 | I-203 | 形式チェック | `@Pattern(regexp="^#[0-9A-Fa-f]{6}$")` | 「カラーコードの形式が不正です（例: #FF5733）」 |
| 5 | I-204 | 最小値 | `@Min(0)` | 「表示順は0以上の整数を入力してください」 |

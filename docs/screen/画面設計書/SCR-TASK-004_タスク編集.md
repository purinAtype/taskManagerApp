# 画面設計書

> **出力先**: `docs/screen/画面設計書/`
> **ファイル名**: `SCR-TASK-004_タスク編集.md`

## 1. 文書情報
| 項目 | 内容 |
| :--- | :--- |
| **画面ID** | SCR-TASK-004 |
| **画面名** | タスク編集 |
| **バージョン** | 1.1.0 |
| **作成日** | 2025-12-09 |
| **作成者** | 画面設計エージェント |
| **最終更新日** | 2025-12-09 |
| **最終更新者** | Claude (screen-designer) |

---

## 2. 概要
### 2.1. 画面目的
既存タスクの情報を編集するための画面。タスク情報の更新、バリデーションチェック、更新処理を行う。

### 2.2. 前提条件
- タスクIDが有効であること
- 指定されたタスクがデータベースに存在すること
- 存在しない場合は404エラー画面（SCR-CMN-001）へ遷移する

---

## 3. レイアウト
### 3.1. 画面スクリーンショット

> **📌 モックアップファイル**: `docs/mockups/04_task_edit.html`

![SCR-TASK-004 タスク編集](../images/SCR-TASK-004.png)


### 3.2. レイアウト構成
- **ヘッダー**: 共通ナビゲーションバー（Task Managerロゴとアイコン）
- **メインコンテンツ**:
  - パンくずリスト: タスク一覧 > 詳細 > 編集
  - フォームカード:
    - カードヘッダー: 「タスク編集」（アイコン `bi-pencil-square` 付き）
    - カードボディ: 入力フォーム
      - タイトル（必須、テキスト入力、maxlength=100、既存値設定）
      - 説明（任意、テキストエリア、maxlength=1000、既存値設定）
      - ステータス（必須、セレクトボックス、既存値選択）
      - 優先度（必須、セレクトボックス、既存値選択）
      - カテゴリー（任意、セレクトボックス、既存値選択）
      - 期限（任意、日付入力、既存値設定）
    - ボタンエリア: キャンセル、更新
- **フッター**: 共通フッター（© 2025 Task Manager Application - Multi-Agent Demo）

---

## 4. 画面遷移
### 4.1. 遷移元
| 画面ID | 画面名 | 遷移トリガー | 備考 |
| :--- | :--- | :--- | :--- |
| SCR-TASK-001 | タスク一覧 | 「編集」ボタン押下 | - |
| SCR-TASK-003 | タスク詳細 | 「編集」ボタン押下 | - |

### 4.2. 遷移先
| 画面ID | 画面名 | 遷移トリガー | 備考 |
| :--- | :--- | :--- | :--- |
| SCR-TASK-003 | タスク詳細 | 「キャンセル」ボタン押下 | 入力内容は破棄される |
| SCR-TASK-003 | タスク詳細 | 更新成功時 | 更新したタスクの詳細画面へリダイレクト、成功メッセージ表示 |
| SCR-CMN-001 | 404エラー | タスクが存在しない場合 | TaskNotFoundException 発生時 |

---

## 5. 画面項目一覧
| No. | 項目ID | 論理名 | ラベル/物理名 | 種別 | 必須 | 初期値/状態 | 備考 |
| :-: | :--- | :--- | :--- | :--- | :-: | :--- | :--- |
| 1 | BC-401 | パンくずリスト | - | ナビゲーション | - | 固定表示 | タスク一覧 > 詳細 > 編集 |
| 2 | S-401 | 画面タイトル | タスク編集 | テキスト表示 | - | 固定表示 | アイコン `bi-pencil-square` 付き |
| 3 | I-401 | タイトル入力 | タイトル | テキスト入力 | ✔ | タスクのタイトル | maxlength=100 |
| 4 | H-401 | タイトルヘルプ | - | ヘルプテキスト | - | 固定表示 | 「100文字以内で入力してください」 |
| 5 | E-401 | タイトルエラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 6 | I-402 | 説明入力 | 説明 | テキストエリア | - | タスクの説明 | rows=4、maxlength=1000 |
| 7 | H-402 | 説明ヘルプ | - | ヘルプテキスト | - | 固定表示 | 「1000文字以内で入力してください」 |
| 8 | E-402 | 説明エラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 9 | I-403 | ステータス選択 | ステータス | セレクトボックス | ✔ | タスクのステータス | 選択肢: TODO（未着手）、IN_PROGRESS（進行中）、DONE（完了） |
| 10 | E-403 | ステータスエラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 11 | I-404 | 優先度選択 | 優先度 | セレクトボックス | ✔ | タスクの優先度 | 選択肢: HIGH（高）、MEDIUM（中）、LOW（低） |
| 12 | E-404 | 優先度エラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 13 | I-405 | カテゴリー選択 | カテゴリー | セレクトボックス | - | タスクのカテゴリー | カテゴリーマスタから動的取得 |
| 14 | I-406 | 期限入力 | 期限 | 日付入力 | - | タスクの期限 | type="date" |
| 15 | E-406 | 期限エラー | - | エラーメッセージ | - | 非表示 | バリデーションエラー時に表示 |
| 16 | B-401 | キャンセルボタン | キャンセル | ボタン | - | 活性 | `/tasks/{id}` へ遷移、アイコン `bi-x-lg` 付き |
| 17 | B-402 | 更新ボタン | 更新 | ボタン | - | 活性 | フォーム送信、アイコン `bi-check-lg` 付き |

---

## 6. イベント仕様
### 6.1. 初期表示処理 (`onLoad`)
1. コントローラー `GET /tasks/{id}/edit` が呼び出される
2. パスパラメータから `id` を取得する
3. TaskService.findById(id) を呼び出し、タスク情報を取得する
4. タスクが存在しない場合:
   - `TaskNotFoundException` がスローされる
   - GlobalExceptionHandler が捕捉し、404エラー画面（SCR-CMN-001）へ遷移する
5. タスクが存在する場合:
   - TaskConverter.toForm(taskDto) により TaskDto を TaskForm に変換する
   - 以下のデータをモデルに設定する:
     - `taskForm`: 既存タスク情報が設定された TaskForm
     - `taskId`: 編集対象のタスクID
     - `statuses`: TaskStatus enum の全値
     - `priorities`: TaskPriority enum の全値
     - `categories`: カテゴリーマスタの全レコード
6. ビュー `task/edit.html` をレンダリングする

### 6.2. 入力項目変更時 (`onChange`)
- （特別な処理なし）

### 6.3. ボタン押下時 (`onClick`)
#### キャンセルボタン（B-401）
1. `/tasks/{id}` へ遷移する（詳細画面へ戻る）
2. 入力内容は破棄される

#### 更新ボタン（B-402）
1. フォーム内の入力値を取得する
2. POST メソッドで `/tasks/{id}` へリクエストを送信する
3. サーバーサイドバリデーションを実行する（詳細は「7. 画面チェック仕様」を参照）
4. バリデーションエラーがある場合:
   - BindingResult にエラー情報が格納される
   - モデルに `taskId` と必要なマスタデータを再設定する
   - ビュー `task/edit.html` を再表示する
   - エラーメッセージが各入力項目の下に表示される（`invalid-feedback`）
   - 入力済みの値は保持される
5. バリデーション成功の場合:
   - TaskService.update(id, taskForm) を呼び出してタスクを更新する
   - フラッシュ属性に成功メッセージ「タスクを更新しました」を設定する
   - 更新したタスクの詳細画面 `/tasks/{id}` へリダイレクトする

---

## 7. 画面チェック仕様（バリデーション）
### 7.1. 登録/更新ボタン押下時 (クライアントサイド)
| No. | 対象項目 | チェック内容 | 条件/正規表現 | エラーメッセージ |
| :-: | :--- | :--- | :--- | :--- |
| 1 | I-401 | 必須入力 | `@NotBlank` | 「タイトルを入力してください」 |
| 2 | I-401 | 最大文字数 | `@Size(max=100)` | 「タイトルは100文字以内で入力してください」 |
| 3 | I-402 | 最大文字数 | `@Size(max=1000)` | 「説明は1000文字以内で入力してください」 |
| 4 | I-403 | 必須選択 | `@NotNull` | 「ステータスを選択してください」 |
| 5 | I-404 | 必須選択 | `@NotNull` | 「優先度を選択してください」 |

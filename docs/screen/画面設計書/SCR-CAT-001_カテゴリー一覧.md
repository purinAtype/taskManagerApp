# 画面設計書

> **出力先**: `docs/screen/画面設計書/`
> **ファイル名**: `SCR-CAT-001_カテゴリー一覧.md`

## 1. 文書情報
| 項目 | 内容 |
| :--- | :--- |
| **画面ID** | SCR-CAT-001 |
| **画面名** | カテゴリー一覧 |
| **バージョン** | 1.0.0 |
| **作成日** | 2025-12-10 |
| **作成者** | 画面設計エージェント |
| **最終更新日** | 2025-12-10 |
| **最終更新者** | Claude (screen-designer) |

---

## 2. 概要
### 2.1. 画面目的
タスクに紐付けるカテゴリーの一覧を表示し、カテゴリーの新規登録・編集・削除を管理する画面。表示順序で並び、視覚的にカラーコードが確認できる。

### 2.2. 前提条件
- タスク管理システムにアクセス可能であること
- カテゴリーマスタ（task_categories）にデータが登録されていること（空でも可）

---

## 3. レイアウト
### 3.1. 画面スクリーンショット

> **📌 モックアップファイル**: `docs/mockups/07_category_list.html`

![SCR-CAT-001 カテゴリー一覧](../images/SCR-CAT-001.png)


### 3.2. レイアウト構成
- **ヘッダー**: 共通ナビゲーションバー（Task Managerロゴとアイコン）
- **メインコンテンツ**:
  - ページタイトル: 「カテゴリー一覧」（アイコン `bi-folder-fill` 付き）
  - 新規登録ボタン: 右上に配置
  - 成功メッセージ（操作後に表示、dismissible）
  - カテゴリー一覧テーブル:
    - カラム: カテゴリー名、説明、カラー（色付きバッジ）、表示順、操作
    - 操作ボタン: 編集、削除（確認モーダル付き）
  - カウント表示: テーブル下部に件数表示
  - 削除確認モーダル: 削除ボタン押下時に表示
- **フッター**: 共通フッター（© 2025 Task Manager Application - Multi-Agent Demo）

---

## 4. 画面遷移
### 4.1. 遷移元
| 画面ID | 画面名 | 遷移トリガー | 備考 |
| :--- | :--- | :--- | :--- |
| SCR-CAT-002 | カテゴリー新規登録 | 登録成功 / キャンセル | - |
| SCR-CAT-003 | カテゴリー編集 | 更新成功 / キャンセル | - |

### 4.2. 遷移先
| 画面ID | 画面名 | 遷移トリガー | 備考 |
| :--- | :--- | :--- | :--- |
| SCR-CAT-002 | カテゴリー新規登録 | 「新規カテゴリー」ボタン押下 | - |
| SCR-CAT-003 | カテゴリー編集 | 編集ボタン押下 | 選択されたカテゴリーIDをパラメータに渡す |
| SCR-CAT-001 | カテゴリー一覧（リロード） | 削除成功 | 削除確認モーダル経由、成功メッセージ表示 |

---

## 5. 画面項目一覧
| No. | 項目ID | 論理名 | ラベル/物理名 | 種別 | 必須 | 初期値/状態 | 備考 |
| :-: | :--- | :--- | :--- | :--- | :-: | :--- | :--- |
| 1 | S-101 | 画面タイトル | カテゴリー一覧 | テキスト表示 | - | 固定表示 | アイコン `bi-folder-fill` 付き |
| 2 | B-101 | 新規登録ボタン | 新規カテゴリー | ボタン | - | 活性 | `/categories/new` へ遷移、アイコン `bi-plus-lg` 付き |
| 3 | M-101 | 成功メッセージ | - | アラート | - | 非表示 | 操作成功時のみ表示（dismissible） |
| 4 | T-101 | カテゴリーテーブル | - | テーブル | - | 初期表示時はデータを表示 | 表示順（display_order）昇順でソート |
| 5 | C-101 | カテゴリー名カラム | カテゴリー名 | テキスト表示 | - | - | task_categories.name |
| 6 | C-102 | 説明カラム | 説明 | テキスト表示 | - | - | task_categories.description（空の場合は「-」） |
| 7 | C-103 | カラーカラム | カラー | バッジ表示 | - | - | task_categories.color、背景色を動的に設定 |
| 8 | C-104 | 表示順カラム | 表示順 | テキスト表示 | - | - | task_categories.display_order |
| 9 | C-105 | 操作カラム | 操作 | ボタングループ | - | - | 編集・削除ボタン |
| 10 | B-102 | 編集ボタン | - | ボタン | - | 活性 | `/categories/{id}/edit` へ遷移、アイコン `bi-pencil` 付き |
| 11 | B-103 | 削除ボタン | - | ボタン | - | 活性 | 削除確認モーダルを表示、アイコン `bi-trash` 付き |
| 12 | L-101 | 件数表示ラベル | - | テキスト表示 | - | 動的表示 | 「全 {件数} 件」 |
| 13 | MD-101 | 削除確認モーダル | カテゴリーの削除 | モーダルダイアログ | - | 非表示 | 削除ボタン押下時に表示 |
| 14 | MD-101-1 | モーダルメッセージ | - | テキスト表示 | - | - | 「このカテゴリーを削除してもよろしいですか?」 |
| 15 | MD-101-2 | モーダルキャンセル | キャンセル | ボタン | - | 活性 | モーダルを閉じる |
| 16 | MD-101-3 | モーダル削除実行 | 削除 | ボタン | - | 活性 | DELETE `/categories/{id}` を実行 |

---

## 6. イベント仕様
### 6.1. 初期表示処理 (`onLoad`)
1. コントローラー `GET /categories` が呼び出される
2. CategoryService.findAll() を呼び出し、全カテゴリーを取得する
3. カテゴリーリストを表示順（display_order）昇順でソートする
4. 以下のデータをモデルに設定する:
   - `categories`: カテゴリーリスト
   - `successMessage`: フラッシュ属性から取得（存在する場合のみ）
5. ビュー `category/list.html` をレンダリングする

### 6.2. 入力項目変更時 (`onChange`)
- （特別な処理なし）

### 6.3. ボタン押下時 (`onClick`)
#### 新規カテゴリーボタン（B-101）
1. `/categories/new` へ遷移する

#### 編集ボタン（B-102）
1. クリックされた行のカテゴリーID（{id}）を取得する
2. `/categories/{id}/edit` へ遷移する

#### 削除ボタン（B-103）
1. クリックされた行のカテゴリーID（{id}）とカテゴリー名を取得する
2. 削除確認モーダル（MD-101）を表示する
3. モーダル内にカテゴリー名を表示する

#### モーダルキャンセルボタン（MD-101-2）
1. 削除確認モーダル（MD-101）を閉じる
2. 削除処理は実行されない

#### モーダル削除実行ボタン（MD-101-3）
1. POST メソッドで `/categories/{id}/delete` へリクエストを送信する
2. CategoryService.delete(id) を呼び出す
3. 削除成功時:
   - フラッシュ属性に成功メッセージ「カテゴリーを削除しました」を設定する
   - カテゴリー一覧画面 `/categories` へリダイレクトする
4. 削除失敗時（タスク使用中エラー等）:
   - エラーメッセージ「このカテゴリーは使用中のため削除できません。紐づくタスクを先に削除または変更してください。」を表示する
   - カテゴリー一覧画面 `/categories` へリダイレクトする

---

## 7. 画面チェック仕様（バリデーション）
### 7.1. 登録/更新ボタン押下時 (クライアントサイド)
| No. | 対象項目 | チェック内容 | 条件/正規表現 | エラーメッセージ |
| :-: | :--- | :--- | :--- | :--- |
| - | - | - | - | この画面にはバリデーションなし |

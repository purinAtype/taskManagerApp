# API設計書

> **出力先**: `docs/api/API設計書/`
> **ファイル名**: `API-TASK-003_タスク登録フォーム表示.md`

## 1. 文書情報

| 項目 | 内容 |
| :--- | :--- |
| **API ID** | API-TASK-003 |
| **API名** | タスク登録フォーム表示 |
| **カテゴリ** | タスク管理 |
| **バージョン** | 1.0.0 |
| **作成日** | 2025-12-09 |
| **作成者** | API設計エージェント |
| **最終更新日** | 2025-12-09 |
| **最終更新者** | API設計エージェント |

---

## 2. API概要

| 項目 | 内容 |
| :--- | :--- |
| **エンドポイント** | `/tasks/new` |
| **HTTPメソッド** | `GET` |
| **機能概要** | タスク新規登録フォームを表示する。初期値を設定したTaskFormとマスタデータを提供する。 |
| **処理種別** | `データ取得` |
| **トランザクション** | `なし` |
| **認証** | `不要` |
| **必要権限** | `なし` |

### 使用場面

- タスク登録画面（SCR-TASK-002）の初期表示
- タスク一覧画面からの「新規タスク」ボタン押下時

---

## 3. リクエスト仕様

### 3.1 パスパラメータ

なし

### 3.2 クエリパラメータ

なし

### 3.3 リクエストボディ

なし

### 3.4 バリデーションルール

該当なし

---

## 4. レスポンス仕様

### 4.1 正常時レスポンス

* **HTTPステータスコード**: `200 OK`
* **Content-Type**: `text/html` (Thymeleafテンプレート)

**レンダリングされるビュー**: `task/form.html`

**モデル属性**:

| 属性名 | 型 | 必須 | 説明 | 例 |
| :--- | :--- | :--- | :--- | :--- |
| `taskForm` | `TaskForm` | ✔ | 初期値設定済みのタスクフォーム | - |
| `statuses` | `TaskStatus[]` | ✔ | ステータスenum全値 | `[TODO, IN_PROGRESS, DONE]` |
| `priorities` | `TaskPriority[]` | ✔ | 優先度enum全値 | `[HIGH, MEDIUM, LOW]` |
| `categories` | `List<TaskCategory>` | ✔ | カテゴリーマスタ全件 | - |

**TaskForm の初期値**:

| フィールド名 | 型 | 初期値 | 説明 |
| :--- | :--- | :--- | :--- |
| `title` | `String` | `null` | タイトル（未設定） |
| `description` | `String` | `null` | 説明（未設定） |
| `status` | `TaskStatus` | `TODO` | ステータス（デフォルト値） |
| `priority` | `TaskPriority` | `MEDIUM` | 優先度（デフォルト値） |
| `categoryId` | `Long` | `null` | カテゴリーID（未設定） |
| `dueDate` | `LocalDate` | `null` | 期限日（未設定） |

---

## 5. 処理詳細

### 5.1 処理ステップ

| ステップ | 処理内容 | 備考 |
| :--- | :--- | :--- |
| 1 | TaskForm.builder() で初期値を設定したTaskFormを作成 | status=TODO, priority=MEDIUM |
| 2 | TaskService.findAllCategories() を呼び出しカテゴリーマスタ取得（SQL1） | - |
| 3 | モデルに taskForm, statuses, priorities, categories を設定 | - |
| 4 | ビュー `task/form.html` をレンダリング | - |

### 5.2 使用サービス

| サービスクラス | メソッド | 役割 |
| :--- | :--- | :--- |
| `TaskService` | `findAllCategories()` | 全カテゴリーを取得 |

### 5.3 使用テーブル

| テーブル名 | 物理名 | 操作 | 用途 |
| :--- | :--- | :--- | :--- |
| カテゴリー | `task_categories` | `SELECT` | カテゴリーマスタの取得 |

### 5.4 SQL詳細

#### SQL1: カテゴリーマスタ取得

**目的**: 全カテゴリーを表示順で取得する

**Mapper**: `TaskCategoryMapper.selectAll`

```sql
SELECT id, name, description, color, display_order, created_at, updated_at
FROM task_categories
ORDER BY display_order ASC
```

**パラメータ**: なし

---

## 6. ビジネスロジック

### 6.1 初期値設定ロジック

- **ステータス**: `TODO` （未着手）
- **優先度**: `MEDIUM` （中）
- **理由**: 新規タスクは通常「未着手」で優先度「中」として登録されることが一般的なため

---

## 7. トランザクション制御

該当なし（参照のみ）

---

## 8. エラーハンドリング

| エラー条件 | HTTPステータス | エラーコード | 処理内容 |
| :--- | :--- | :--- | :--- |
| DB接続エラー | 500 | INTERNAL_SERVER_ERROR | 500エラー画面（SCR-CMN-002）を表示、ログ出力 |

---

## 9. 外部連携

該当なし

---

## 10. 関連API

| API名 | エンドポイント | 関係性 |
| :--- | :--- | :--- |
| タスク登録 | `POST /tasks` | フォーム送信先 |
| タスク一覧取得 | `GET /tasks` | キャンセル時の遷移先 |

---

## 11. テストケース

### 11.1 正常系

| No. | テストケース | 入力値 | 期待結果 |
| :--- | :--- | :--- | :--- |
| 1 | フォーム初期表示 | なし | 200 OK、status=TODO, priority=MEDIUMの初期値を設定 |
| 2 | カテゴリーマスタが存在する | カテゴリー3件 | 200 OK、3件のカテゴリーをセレクトボックスに表示 |
| 3 | カテゴリーマスタが0件 | カテゴリー0件 | 200 OK、空のカテゴリーリストを設定 |

### 11.2 異常系

| No. | テストケース | 入力値 | 期待結果 |
| :--- | :--- | :--- | :--- |
| 1 | DB接続エラー | - | 500 INTERNAL_SERVER_ERROR |

### 11.3 境界値

該当なし

---

## 12. 備考

- TaskFormはBuilderパターンで初期値を設定している
- ステータスと優先度のデフォルト値はビジネス要件に基づき設定
- カテゴリーは任意項目のため、未設定でも登録可能
- MyBatisマッパーは `TaskCategoryMapper` を使用

---

## 13. 変更履歴

| バージョン | 変更日 | 変更者 | 変更内容 |
| :--- | :--- | :--- | :--- |
| 1.0.0 | 2025-12-09 | API設計エージェント | 新規作成 |

# API設計書

> **出力先**: `docs/api/API設計書/`
> **ファイル名**: `API-{機能}-{連番}_{API名}.md`
> **例**: `API-TASK-001_タスク一覧取得.md`

## 1. 文書情報

| 項目 | 内容 |
| :--- | :--- |
| **API ID** | API-{機能}-{連番} |
| **API名** | {API名} |
| **カテゴリ** | {タスク管理 / カテゴリー管理 / 共通 など} |
| **バージョン** | 1.0.0 |
| **作成日** | YYYY-MM-DD |
| **作成者** | {作成者名} |
| **最終更新日** | YYYY-MM-DD |
| **最終更新者** | {更新者名} |

---

## 2. API概要

| 項目 | 内容 |
| :--- | :--- |
| **エンドポイント** | `{例: /tasks/{id}}` |
| **HTTPメソッド** | `{GET / POST / PUT / PATCH / DELETE}` |
| **機能概要** | {APIが何をする機能なのかを簡潔に説明} |
| **処理種別** | `{データ取得 / データ登録 / データ更新 / データ削除}` |
| **トランザクション** | `{あり / なし}` |
| **認証** | `{不要}` |
| **必要権限** | `{なし}` |

### 使用場面

- {例: タスク一覧画面の初期表示}
- {例: タスク新規作成画面のフォーム送信}

---

## 3. リクエスト仕様

### 3.1 パスパラメータ

| 名前 | 型 | 必須 | 説明 | 例 |
| :--- | :--- | :--- | :--- | :--- |
| `{例: id}` | `Long` | ✔ | {例: タスクID} | `1` |

*パスパラメータがない場合は「なし」と記載*

### 3.2 クエリパラメータ

| 名前 | 型 | 必須 | 説明 | デフォルト | 例 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `{例: status}` | `String` | - | {例: ステータスで絞り込み} | - | `TODO` |
| `{例: priority}` | `String` | - | {例: 優先度で絞り込み} | - | `HIGH` |
| `{例: categoryId}` | `Long` | - | {例: カテゴリーIDで絞り込み} | - | `1` |

*クエリパラメータがない場合は「なし」と記載*

### 3.3 リクエストボディ

*(POST, PUT, PATCH の場合に記載。GET, DELETE の場合は「なし」)*

**例:**
```json
{
  "title": "レポート作成",
  "description": "月次レポートを作成する",
  "status": "TODO",
  "priority": "HIGH",
  "categoryId": 1,
  "dueDate": "2025-12-31"
}
```

**フィールド定義:**

| フィールド名 | 型 | 必須 | 説明 | 制約 |
| :--- | :--- | :--- | :--- | :--- |
| `title` | `String` | ✔ | タスクタイトル | 最大100文字 |
| `description` | `String` | - | タスク説明 | 最大500文字 |
| `status` | `String` | ✔ | ステータス | TODO/IN_PROGRESS/DONE |
| `priority` | `String` | ✔ | 優先度 | HIGH/MEDIUM/LOW |
| `categoryId` | `Long` | - | カテゴリーID | - |
| `dueDate` | `String` | - | 期限日 | yyyy-MM-dd形式 |

### 3.4 バリデーションルール

| 項目 | バリデーション内容 | エラーメッセージ |
| :--- | :--- | :--- |
| `title` | 必須、1～100文字、空白のみ不可 | "タイトルは1～100文字で入力してください" |
| `status` | TODO/IN_PROGRESS/DONEのいずれか | "ステータスが不正です" |
| `priority` | HIGH/MEDIUM/LOWのいずれか | "優先度が不正です" |

---

## 4. レスポンス仕様

### 4.1 正常時レスポンス

* **HTTPステータスコード**: `{200 OK / 201 Created / 204 No Content}`

**例:**
```json
{
  "id": 1,
  "title": "レポート作成",
  "description": "月次レポートを作成する",
  "status": "TODO",
  "priority": "HIGH",
  "categoryId": 1,
  "categoryName": "仕事",
  "dueDate": "2025-12-31",
  "createdAt": "2025-01-15T10:30:00",
  "updatedAt": "2025-01-15T10:30:00"
}
```

**フィールド定義:**

| フィールド名 | 型 | 必須 | 説明 | 例 |
| :--- | :--- | :--- | :--- | :--- |
| `id` | `Long` | ✔ | タスクID | `1` |
| `title` | `String` | ✔ | タスクタイトル | `"レポート作成"` |
| `description` | `String` | - | タスク説明 | `"月次レポートを作成する"` |
| `status` | `String` | ✔ | ステータス | `"TODO"` |
| `priority` | `String` | ✔ | 優先度 | `"HIGH"` |
| `categoryId` | `Long` | - | カテゴリーID | `1` |
| `categoryName` | `String` | - | カテゴリー名 | `"仕事"` |
| `dueDate` | `String` | - | 期限日 | `"2025-12-31"` |
| `createdAt` | `String` | ✔ | 作成日時 | `"2025-01-15T10:30:00"` |
| `updatedAt` | `String` | ✔ | 更新日時 | `"2025-01-15T10:30:00"` |

### 4.2 一覧取得時のレスポンス

*(一覧取得APIの場合に記載。該当しない場合は削除)*

```json
[
  {
    "id": 1,
    "title": "レポート作成",
    "status": "TODO",
    "priority": "HIGH",
    ...
  },
  {
    "id": 2,
    "title": "会議資料準備",
    "status": "IN_PROGRESS",
    "priority": "MEDIUM",
    ...
  }
]
```

---

## 5. 処理詳細

### 5.1 処理ステップ

| ステップ | 処理内容 | 備考 |
| :--- | :--- | :--- |
| 1 | {例: タスクの存在チェック}（SQL1） | {説明} |
| 2 | {例: タスク情報取得/登録/更新/削除}（SQL2） | {説明} |

### 5.2 使用テーブル

| テーブル名 | 物理名 | 操作 | 用途 |
| :--- | :--- | :--- | :--- |
| タスク | `task` | `SELECT/INSERT/UPDATE/DELETE` | タスク情報の操作 |
| カテゴリー | `task_category` | `SELECT` | カテゴリー情報の参照 |

### 5.3 SQL詳細

#### SQL1: {SQL名}

**目的**: {目的を記載}

```sql
SELECT
  t.id,
  t.title,
  t.description,
  t.status,
  t.priority,
  t.category_id,
  c.name AS category_name,
  t.due_date,
  t.created_at,
  t.updated_at
FROM task t
LEFT JOIN task_category c ON t.category_id = c.id
WHERE t.id = #{id};
```

**パラメータ:**

| パラメータ名 | 型 | 説明 | 例 |
| :--- | :--- | :--- | :--- |
| `#{id}` | `Long` | タスクID | `1` |

---

## 6. ビジネスロジック

*(計算式、判定条件、データ加工処理など。単純なCRUDの場合は「該当なし」)*

該当なし

---

## 7. トランザクション制御

*(データ更新を伴う場合に記載。参照のみの場合は「該当なし」)*

| 項目 | 内容 |
| :--- | :--- |
| **トランザクション境界** | {開始～終了の範囲} |
| **コミット条件** | {すべてのSQL正常実行時} |
| **ロールバック条件** | {エラー発生時、バリデーション失敗時} |

---

## 8. エラーハンドリング

| エラー条件 | HTTPステータス | エラーコード | 処理内容 |
| :--- | :--- | :--- | :--- |
| タスク未存在 | 404 | NOT_FOUND | エラー返却 |
| バリデーションエラー | 400 | BAD_REQUEST | エラー返却 |
| DB接続エラー | 500 | INTERNAL_SERVER_ERROR | ログ出力 |

---

## 9. 外部連携

*(外部API、メール送信などの連携がある場合に記載。ない場合は「該当なし」)*

該当なし

---

## 10. 関連API

| API名 | エンドポイント | 関係性 |
| :--- | :--- | :--- |
| {例: タスク一覧取得} | `/tasks` | 同一リソース |
| {例: カテゴリー一覧取得} | `/categories` | マスタ参照 |

---

## 11. テストケース

### 11.1 正常系

| No. | テストケース | 入力値 | 期待結果 |
| :--- | :--- | :--- | :--- |
| 1 | {例: 全項目指定で登録} | {入力値} | 201 Created |

### 11.2 異常系

| No. | テストケース | 入力値 | 期待結果 |
| :--- | :--- | :--- | :--- |
| 1 | {例: 必須項目欠損} | `title: null` | 400 BAD_REQUEST |
| 2 | {例: 存在しないタスク} | `id: 99999` | 404 NOT_FOUND |

### 11.3 境界値

| No. | テストケース | 入力値 | 期待結果 |
| :--- | :--- | :--- | :--- |
| 1 | {例: タイトル最大文字数} | `title: "a" × 100` | 正常終了 |
| 2 | {例: タイトル文字数超過} | `title: "a" × 101` | 400 BAD_REQUEST |

---

## 12. 備考

*(実装時の注意事項、既知の制約など)*

- MyBatisマッパーは `TaskMapper` を使用

---

## 13. 変更履歴

| バージョン | 変更日 | 変更者 | 変更内容 |
| :--- | :--- | :--- | :--- |
| 1.0.0 | YYYY-MM-DD | {作成者} | 新規作成 |
